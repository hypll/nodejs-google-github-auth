<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include("../../partials/head.ejs") %>

        <title>Dashboard - <%- username %></title>
    </head>
    <body>
        <!-- Navbar path: /partials/navbar -->
        <%- include('../../partials/navbar.ejs') %>

        <section class="card">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card-body">
                            <h2 class="card-title">Dashboard</h2>
                            <p class="card-text">Welcome <%- username %>!</p>
                            <a href="/dashboard#upload" class="btn btn-primary"
                                >Upload</a
                            >
                            <a
                                href="/dashboard#images"
                                class="btn btn-secondary"
                            >
                                Images
                            </a>
                            <a
                                type="button"
                                href="/profile/<%- userMagikId %>"
                                target="_blank"
                                class="btn btn-success"
                            >
                                <i class="fas fa-external-link"></i> Profile
                            </a>
                        </div>
                        <div class="card-body">
                            <h2 class="card-title">Your Account</h2>
                            <div class="">
                                <img
                                    src="<%- profilePicture %>"
                                    alt="profile picture"
                                    width="10%"
                                    id="profilePicture"
                                    style="
                                        border-radius: 100%;
                                        box-shadow: 0 1px 3px
                                                rgba(0, 0, 0, 0.12),
                                            0 1px 2px rgba(0, 0, 0, 0.24);
                                    "
                                />
                            </div>

                            <div class="card-body">
                                <strong>Username</strong>
                                <p class="card-text" style="color: gray">
                                    <%- username %>
                                </p>

                                <% if (disName) { %>
                                <form
                                    action="/api/update/user/<%- id %> "
                                    class="mt-4 mb-3"
                                    method="GET"
                                    enctype="multipart/form-data"
                                >
                                    <div class="form-group">
                                        <label for="displayName"
                                            >Display Name</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="displayName"
                                            name="displayName"
                                            placeholder="Enter a Display Name"
                                            required
                                            value="<%- disName %>"
                                            disabled
                                        />
                                    </div>
                                    <button
                                        type="submit"
                                        class="btn btn-primary btn-sm mt-2 mb-2"
                                        disabled
                                    >
                                        Update
                                    </button>
                                </form>

                                <% } %> <% if (userEmail) { %>
                                <form
                                    action="/api/update/user/<%- id %> "
                                    class="mb-3"
                                    method="GET"
                                    enctype="multipart/form-data"
                                >
                                    <div class="form-group">
                                        <label for="displayName">Email</label>
                                        <input
                                            type="text"
                                            class="form-control"
                                            id="displayName"
                                            name="displayName"
                                            placeholder="Enter a Display Name"
                                            required
                                            value="<%- userEmail %>"
                                            disabled
                                        />
                                    </div>
                                    <button
                                        type="submit"
                                        class="btn btn-secondary btn-sm mt-2 mb-2"
                                        disabled
                                    >
                                        Update
                                    </button>
                                </form>

                                <% } %>

                                <strong>üìç Bio</strong>
                                <form
                                    action="/api/updateBio"
                                    class="mb-4"
                                    method="POST"
                                >
                                    <input
                                        type="text"
                                        class="form-control mb-2"
                                        id="bio"
                                        placeholder="Tell us a little about yourself"
                                        disabled
                                    />

                                    <button
                                        type="submit"
                                        class="btn btn-success btn-sm"
                                        disabled
                                    >
                                        Update
                                    </button>
                                </form>

                                <div class="mb-4">
                                    <strong
                                        >Magik ID
                                        <span
                                            class="text-secondary ml-5"
                                            id="question"
                                            ><i
                                                class="fa fa-question-circle"
                                            ></i></span
                                    ></strong>
                                    <input
                                        type="text"
                                        class="form-control mb-2"
                                        placeholder="Magik ID"
                                        value="<%- userMagikId %>"
                                        disabled
                                    />
                                    <button
                                        id="copy"
                                        class="btn btn-primary btn-sm"
                                        value="<%- userMagikId %>"
                                    >
                                        Copy ID
                                    </button>
                                </div>

                                <div class="mb-4">
                                    <strong>Plan:</strong>
                                    <p class="card-text" style="color: gray">
                                        <% if (isPremium == true) { %>
                                        <span class="badge bg-success"
                                            >üíé Premium</span
                                        >
                                        <% } else { %>
                                        <span class="badge bg-danger"
                                            >‚ú® Free</span
                                        >
                                        <% } %>
                                    </p>
                                </div>

                                <% if (userRole == "admin") { %>
                                <div class="mb-4">
                                    <strong>Admin</strong>
                                    <p class="card-text" style="color: gray">
                                        Go to the admin panel to manage users
                                    </p>
                                    <a
                                        href="/dashboard/admin"
                                        class="btn btn-primary btn-sm"
                                    >
                                        Go to Admin Panel
                                    </a>
                                </div>
                                <% } %>

                                <div class="mb-4">
                                    <strong>Joined</strong>
                                    <p class="card-text" style="color: gray">
                                        <%- joinedAt %>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <a href="/auth/logout" class="btn btn-danger"
                                ><i class="fa fa-sign-out-alt"></i> Logout</a
                            >
                            <a
                                id="delete"
                                onclick="deleteAccountWithConfirm()"
                                class="btn btn-warning"
                                ><i class="fa fa-trash"></i> Delete Account</a
                            >
                        </div>
                    </div>
                </div>
            </div>
            <script>
                function deleteAccountWithConfirm() {
                    if (
                        confirm(
                            "Are you sure you want to delete your account? \n This action cannot be undone."
                        )
                    ) {
                        window.location.href = "/api/delete";
                    }
                }

                const copyBtn = document.getElementById("copy");
                copyBtn.addEventListener("click", () => {
                    const val = "<%- userMagikId %>";
                    navigator.clipboard.writeText(val);
                    copyBtn.innerText = "‚úÖ Copied!";
                    copyBtn.classList.add("Copied");
                    setTimeout(() => {
                        copyBtn.innerText = "Copy ID";
                        copyBtn.classList.remove("copied");
                    }, 2000);
                });

                const question = document.getElementById("question");
                question.addEventListener("click", () => {
                    alert(
                        "Your Magik ID is your unique identifier for your account. It provides you with the ability to share your profile with others. \n\n You can't change your Magik ID \n\n You can find your Magik ID on the dashboard page."
                    );
                });
            </script>
        </section>

        <!-- Upload type: component path: partials/upload -->
        <%- include('../../partials/upload.ejs') %>

        <!-- Images type: component  -->
        <%- include('../../partials/images.ejs') %>
    </body>
</html>
