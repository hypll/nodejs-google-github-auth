<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include('../../partials/head.ejs') %>
        <title>Dashboard - Admin Panel</title>
    </head>
    <body>
        <%- include('../../partials/navbar.ejs') %>

        <section class="container mt-2">
            <div class="row">
                <div class="col-md-12">
                    <h1>Admin Panel</h1>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Dashboard</h5>
                            <p class="card-text">Welcome to the admin panel.</p>
                            <p class="card-text">
                                On this admin panel, you can manage the users
                                and images on the platform.
                            </p>
                        </div>
                    </div>
                </div>
                <form class="row mt-5">
                    <div class="col-md-12">
                        <div>
                            <h4>Search any user on the platform</h4>
                        </div>
                        <div class="input-group mb-3">
                            <input
                                type="text"
                                class="form-control"
                                placeholder="Search users..."
                                id="search"
                                name="search"
                                required
                            />
                            <div class="input-group-append">
                                <button
                                    class="btn btn-outline-dark"
                                    type="button"
                                    id="search-button"
                                >
                                    Search
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="row mt-5">
                <div class="col-md-12">
                    <h2>Users</h2>
                </div>
                <div class="col-md-12">
                    <% for (let user of users) { %>

                    <div
                        class="card mb-3"
                        id="<%- user._id %> "
                        data-id="<%- user._id %>"
                    >
                        <div class="card-body">
                            <h5 class="card-title"><%- user.userName %></h5>
                            <p class="card-text text-secondary">
                                <%- user._id %>
                            </p>
                            <div class="mb-2">
                                <p class="card-text" data-id="<%- user._id %>">
                                    <strong>Magik ID:</strong> <%-
                                    user.userMagikId %>
                                </p>
                                <% if (userEmail) { %>
                                <p class="card-text" data-id="<%- user._id %>">
                                    <strong>Email:</strong> <%- user.userEmail
                                    || 'This user does not have an email'%>
                                </p>
                                <% } %>
                                <p
                                    class="card-text"
                                    data-disName="<%- user.displayName %>"
                                >
                                    <strong>Display Name:</strong> <%-
                                    user.displayName %>
                                </p>
                                <p
                                    class="card-text"
                                    dataRole="<%- user.userRole %> "
                                >
                                    <strong>Role:</strong> <%- user.userRole %>
                                </p>
                                <p
                                    class="card-text"
                                    data-provider="<%- user.provider %> "
                                >
                                    <strong>Provider:</strong> <%- user.provider
                                    %> (<%- user.userId %>)
                                </p>

                                <p
                                    class="card-text"
                                    data-joinedAt="<%- user.joinedAt %> "
                                >
                                    <strong>Created:</strong> <%- user.joinedAt
                                    %>
                                </p>
                                <div class="col-md-4">
                                    <img
                                        src="<%- user.profilePicture %>"
                                        alt="<%- username %>"
                                        class="img-fluid"
                                        style="
                                            max-width: 30%;
                                            border-radius: 50%;
                                        "
                                    />
                                </div>
                            </div>

                            <a
                                href="/api/delete/user/<%- user._id %> "
                                onclick="return confirm('Are you sure you want to delete this user?')"
                                class="btn btn-danger"
                                id="<%- user._id %> "
                            >
                                <i class="fa fa-trash-alt"></i> Delete
                            </a>
                            <button
                                class="btn btn-secondary"
                                href="/api/ban/user/<%- user._id %>"
                                onclick="return confirm('Are you sure you want to ban this user?')"
                                disabled
                            >
                                <i class="fa-solid fa-hammer"></i> Ban
                            </button>

                            <a
                                type="button"
                                href="/profile/<%- user.userMagikId %> "
                                target="_blank"
                                class="btn btn-success"
                            >
                                <i class="fas fa-external-link"></i> View
                                Profile
                            </a>
                        </div>
                    </div>

                    <% } %>
                </div>
            </div>
        </section>
        <script>
            if (window.location.pathname === "/dashboard/admin") {
                document.getElementById("dashboard").classList.add("active");
            }

            if (window.location.pathname === "/dashboard/admin") {
                document.getElementById("home").classList.remove("active");
            }

            const searchBtn = document.getElementById("search-button");

            searchBtn.addEventListener("click", () => {
                const search = document.getElementById("search").value;

                if (search.length > 0) {
                    window.location.href = `/dashboard/admin/search?target=${search}`;
                    target = "_blank";
                }
            });

            function logout() {
                window.location.href = "/auth/logout";
            }

            function upload() {
                window.location.href = "/dashboard#upload";
            }
        </script>
    </body>
</html>
